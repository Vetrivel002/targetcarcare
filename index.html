<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Target Car Care | Billing System</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

<div class="wrapper">
    <header><h1>TARGET CAR CARE</h1></header>

    <div class="main-grid">
        <div class="left-panel">
            <section class="card">
                <h2>Customer & Vehicle</h2>
                <div class="form-row">
                    <div class="input-group"><label>Customer Name</label><input type="text" id="custName"></div>
                    <div class="input-group"><label>Mobile Number</label><input type="text" id="custMobile"></div>
                </div>
                <div class="form-row">
                    <div class="input-group"><label>Vehicle Name</label><input type="text" id="vName"></div>
                    <div class="input-group"><label>Vehicle Number</label><input type="text" id="vNo"></div>
                </div>
                <div class="form-row">
                    <div class="input-group"><label>GST/PAN</label><input type="text" id="custGST"></div>
                    <div class="input-group"><label>Email</label><input type="email" id="custEmail"></div>
                </div>
                <div class="input-group"><label>Address</label><input type="text" id="custAddr"></div>
            </section>

            <section class="card">
                <h2>Company Details</h2>
                <div class="form-row">
                    <input type="text" id="compName" value="TARGET Multi-brand Car Service">
                    <input type="text" id="compMobile" value="8438143591">
                </div>
                <textarea id="compAddr" rows="2">SRIRAM NAGAR, Veeranam Main Rd, near NEW INDIA DISCOVARY SCHOOL, Salem - 636003</textarea>
            </section>

            <section class="card">
                <h2>Search Invoice</h2>
                <div class="form-row">
                    <input type="text" id="searchQuery" placeholder="Inv No or Mobile">
                    <button class="btn btn-add" style="margin:0" onclick="searchInvoice()">Search</button>
                </div>
                <div id="search-results"></div>
            </section>
        </div>

        <div class="right-panel">
            <section class="card">
                <h2>Services & Charges</h2>
                <table id="productTable">
                    <thead>
                        <tr><th width="50%">Description</th><th>Rate</th><th width="15%">Qty</th><th style="text-align:right">Total</th></tr>
                    </thead>
                    <tbody id="productBody">
                        <tr>
                            <td><input type="text" class="p-name" placeholder="E.g. Full Oil Service"></td>
                            <td><input type="number" class="p-rate" value="0" oninput="calculateFinal()"></td>
                            <td><input type="number" class="p-qty" value="1" oninput="calculateFinal()"></td>
                            <td class="p-total-cell">0.00</td>
                        </tr>
                    </tbody>
                </table>
                <button class="btn btn-add" onclick="addRow()">+ Add New Service</button>

                <div class="form-row" style="margin-top:20px;">
                    <div class="input-group"><label>Tax (%)</label><input type="number" id="taxPerc" value="0" oninput="calculateFinal()"></div>
                    <div class="input-group"><label>Disc (%)</label><input type="number" id="discPerc" value="0" oninput="calculateFinal()"></div>
                    <div class="input-group"><label>Disc (Fixed ₹)</label><input type="number" id="discFixed" value="0" oninput="calculateFinal()"></div>
                </div>

                <div class="summary-bar">
                    <span>Payable Amount:</span>
                    <h2 id="liveGrand" style="margin:0; color:white; font-size:1.6rem;">₹ 0</h2>
                </div>
                
                <div class="form-row" style="margin-top:15px;">
                    <select id="payMode"><option>Cash</option><option>UPI</option><option>Card</option><option>Bank Transfer</option></select>
                    <input type="text" id="payRef" placeholder="Ref ID / Trans ID">
                </div>

                <button class="btn btn-brand" onclick="generateInvoice()">GENERATE & DOWNLOAD INVOICE</button>
            </section>
        </div>
    </div>

    <div id="invoice-sheet">
        <div class="inv-header">
            <img src="logo.png" class="comp-logo" alt="Logo">
            <div class="comp-details">
                <h1 id="out-compName"></h1>
                <p id="out-compAddr"></p>
                <p id="out-compContact" style="font-weight:700; font-size:13px;"></p>
            </div>
            <div style="text-align:right; width:90px">
                <h4 style="margin:0; text-decoration: underline;">INVOICE</h4>
            </div>
        </div>

        <div class="inv-top-info">
            <div>
                <h3>BILL TO</h3>
                <p><strong id="out-custName"></strong></p>
                <p id="out-vInfo"></p>
                <p id="out-custContact"></p>
                <p id="out-custGST"></p>
            </div>
            <div style="text-align: right;">
                <p><strong>Invoice No:</strong> <span id="out-invNo"></span></p>
                <p><strong>Date:</strong> <span id="out-date"></span></p>
                <p><strong>Payment:</strong> <span id="out-payMode"></span></p>
            </div>
        </div>

        <table class="inv-table">
            <thead>
                <tr><th width="8%">S.No</th><th>Description of Service</th><th width="15%">Rate</th><th width="10%">Qty</th><th width="18%">Amount</th></tr>
            </thead>
            <tbody id="out-items"></tbody>
        </table>

        <div class="inv-footer">
            <div class="total-box">
                <div class="total-row"><span>Sub-Total</span><span id="out-sub"></span></div>
                <div class="total-row"><span>Taxable Amount</span><span id="out-tax"></span></div>
                <div class="total-row"><span>Total Discount</span><span id="out-disc"></span></div>
                <div class="grand-total-row"><span>GRAND TOTAL</span><span id="out-grand"></span></div>
            </div>
        </div>

        <div class="signature-container">
            <div class="signature-line">Authority Signature</div>
        </div>
    </div>
</div>

<script src="script.js"></script>
</body>
</html>
