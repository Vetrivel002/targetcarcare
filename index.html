<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Target Car Care | Professional Billing</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

<div class="container">
    <header><h1>Target Car Care</h1></header>

    <div class="grid">
        <div>
            <section class="card">
                <h2>Business Identity</h2>
                <div class="input-group"><label>Company Name</label><input type="text" id="compName" value="TARGET Multi-brand Car Service"></div>
                <div class="input-group" style="margin-top:15px;"><label>Address</label><textarea id="compAddr" rows="3">SRIRAM NAGAR, Veeranam Main Rd, Salem, Tamil Nadu 636003</textarea></div>
                <div class="grid" style="margin-top:15px;">
                    <div class="input-group"><label>Mobile</label><input type="text" id="compMobile" value="8438143591"></div>
                    <div class="input-group"><label>GSTIN</label><input type="text" id="compGST" placeholder="Optional"></div>
                </div>
            </section>

            <section class="card">
                <h2>Customer Information</h2>
                <div class="input-group"><label>Client Name</label><input type="text" id="custName" placeholder="Enter Name"></div>
                <div class="grid" style="margin-top:15px;">
                    <div class="input-group"><label>Contact No</label><input type="text" id="custMobile" placeholder="9876543210"></div>
                    <div class="input-group"><label>Vehicle No</label><input type="text" id="custTax" placeholder="TN-XX-XXXX"></div>
                </div>
            </section>
        </div>

        <div>
            <section class="card">
                <h2>Service & Parts</h2>
                <table id="productTable">
                    <thead>
                        <tr><th>Description</th><th>Rate</th><th>Qty</th><th>Total</th></tr>
                    </thead>
                    <tbody id="productBody">
                        <tr>
                            <td><input type="text" class="p-name" placeholder="E.g. Full Service"></td>
                            <td><input type="number" class="p-rate" value="0" oninput="calculateFinal()"></td>
                            <td><input type="number" class="p-qty" value="1" oninput="calculateFinal()"></td>
                            <td class="p-total">0.00</td>
                        </tr>
                    </tbody>
                </table>
                <button class="btn btn-add" onclick="addRow()">+ Add Line Item</button>

                <div class="grid" style="margin-top:25px;">
                    <div class="input-group"><label>Tax (%)</label><input type="number" id="taxPerc" value="0" oninput="calculateFinal()"></div>
                    <div class="input-group"><label>Discount (%)</label><input type="number" id="discPerc" value="0" oninput="calculateFinal()"></div>
                </div>

                <div class="live-total-bar">
                    <span>Total Amount Payable:</span>
                    <h3 id="liveGrandTotal">â‚¹ 0.00</h3>
                </div>
            </section>

            <section class="card">
                <h2>Payment Settlement</h2>
                <div class="grid">
                    <div class="input-group">
                        <label>Mode</label>
                        <select id="payMode" onchange="togglePayDetails()">
                            <option value="Cash">Cash</option>
                            <option value="UPI">UPI</option>
                            <option value="Card">Card Transfer</option>
                        </select>
                    </div>
                    <div class="input-group" id="refGroup" style="display:none;">
                        <label id="refLabel">Transaction ID</label>
                        <input type="text" id="payRef">
                    </div>
                </div>
            </section>
        </div>
    </div>

    <button class="btn btn-primary" onclick="generateInvoice()">Generate Professional Invoice</button>

    <div id="invoice-template" class="invoice-container">
        <div class="inv-header">
            <img src="logo.png" class="inv-logo-sm" alt="Logo">
            <div class="inv-company-info">
                <h1 id="out-compName"></h1>
                <p id="out-compAddr" style="font-size: 11px; max-width: 400px; margin: 5px auto;"></p>
                <p id="out-compContact" style="font-size: 12px; font-weight: bold;"></p>
            </div>
            <div class="inv-meta">
                <h2 style="color: #000; margin: 0;">TAX INVOICE</h2>
                <p id="out-invNo" style="font-weight:bold;"></p>
                <p id="out-date"></p>
            </div>
        </div>

        <div class="inv-grid">
            <div class="bill-to">
                <small style="color:#666">CUSTOMER DETAILS</small>
                <p id="out-custName" style="font-weight: bold; font-size: 16px; margin: 5px 0;"></p>
                <p id="out-custAddr"></p>
                <p id="out-custContact"></p>
            </div>
            <div style="text-align: right;">
                <small style="color:#666">PAYMENT INFO</small>
                <p id="out-payMode" style="font-weight: bold; margin: 5px 0;"></p>
                <p id="out-payRef" style="font-size: 12px;"></p>
            </div>
        </div>

        <table class="inv-table">
            <thead>
                <tr><th>Description</th><th style="text-align:right">Rate</th><th style="text-align:center">Qty</th><th style="text-align:right">Amount</th></tr>
            </thead>
            <tbody id="out-items"></tbody>
        </table>

        <div class="inv-total-box">
            <div style="display:flex; justify-content:space-between;"><span>Subtotal:</span><span id="out-sub"></span></div>
            <div style="display:flex; justify-content:space-between; margin: 5px 0;"><span>Tax & Fees:</span><span id="out-tax"></span></div>
            <div style="display:flex; justify-content:space-between; font-weight:bold; font-size: 18px; border-top: 1px solid #000; padding-top:10px;">
                <span>NET PAYABLE:</span><span id="out-grand"></span>
            </div>
        </div>

        <div class="inv-footer">
            <div class="sig-line"></div>
            <p style="font-size: 12px; font-weight: bold;">Authorized Signatory for Target Car Care</p>
        </div>
    </div>

    <center><button id="downloadBtn" class="btn btn-add" style="display:none; width: 300px; margin-top: 20px;" onclick="downloadJPG()">Download as JPEG</button></center>
</div>

<script src="script.js"></script>
</body>
</html>
